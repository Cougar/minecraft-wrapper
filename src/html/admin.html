<!-- I'm sorry for how sloppy this code is. I truly am. -->
<html>
	<head>
		<script type="text/javascript" src="requests.js"></script>
		<script type="text/javascript" >
			_ = function(id) {return document.getElementById(id)}
			function isAuthed(){
				if(!localStorage.sessionKey) return false
				if(requests.action("is_admin", {"key": localStorage.sessionKey})["status"] == "good") return true
				return false
			}
			function loginWithPassword(password){
				r = requests.action("login", {"password": password})
				if (r["payload"] != "unknown_key"){
					localStorage.sessionKey = r["payload"]["session-key"]
					console.log("Login Success!")
					window.location = ""
				}
				else{
					_("login_invalid").style.display = "block"
				}
			}
			window.onload = function() {
				if(isAuthed()){
					_("login_page").style.display = 'none'
					_("admin_page").style.display = 'block'
					tick()
				}
			}
			function tick(){
				setTimeout("tick()", 3000)
				stats = requests.admin("admin_stats", {})
				if(stats["status"] == "error"){
					console.log("Error while refreshing stats. Connection lost?")
					return
				}
				statusMessages = {0: "<r>Server stopped</r>", 1: "<y>Server starting...</y>", 2: "<g>Running</g>", 3: "<y>Server stopping...</y>"}
				if(stats["server_state"] in statusMessages) _("server_status").innerHTML = statusMessages[stats["server_state"]]
				_("playercount_status").innerHTML = stats["playerCount"] + " players"
			}

			// admining functions
			function _start(){
				requests.admin("server_action", {"action": "start"})
			}
			function _stop(){
				requests.admin("server_action", {"action": "stop"})
			}
			function _restart(){
				requests.admin("server_action", {"action": "restart"})
			}
			function _login(){
				loginWithPassword(_('login_password').value)
			}
			function _logout(){
				requests.admin("logout", {})
				window.location = ""
			}
		</script>
		<style type="text/css">
			r{color:red;}
			y{color:gold;}
			g{color:green;}
		</style>
	</head>
	<body>
		<div id="login_page">
			<h1>Wrapper.py Admin Login</h1>
			<div id="login_invalid" style="display:none;color:red;font-weight:bold;">The password was invalid.</div>
			Password: <input type="password" id="login_password" onkeydown="if(event.keyCode==13)_login();"/><button onclick="_login()">Login</button>
		</div>
		<div id="admin_page" style="display:none;">
			<h1>Wrapper.py Admin Page</h1>
			<button onclick="_logout()">Logout</button></br></br>
			This information refreshes every three seconds.</br>
			<b>Server Status: </b> <span id="server_status">Running</span></br>
			<b>Player Count: </b> <span id="playercount_status">2 players</span></br>
			</br></br>Server: <button onclick="_start()">Start</button> <button onclick="_restart()">Restart</button> <button onclick="_stop()">Stop</button>
		</div>
	</body>
</html>